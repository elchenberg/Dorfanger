window.onload=function(){"use strict";var c,b,o,k,d,e,g,j,a,i,q,r,n,l,m,h,p,f;h=function(t){var u,s,v;t.preventDefault();s=void 0;v=void 0;u=c.foreground.offsetWidth/c.foreground.width;if(t.type==="touchstart"){i.type="touch";s=t.targetTouches[0].pageX-c.foreground.offsetLeft;v=t.targetTouches[0].pageY-c.foreground.offsetTop;}else{i.type="click";s=t.layerX;v=t.layerY;}i.update=true;i.target={column:Math.floor(s/r.tilesize/u),row:Math.floor(v/r.tilesize/u)};i.change={column:NaN,row:NaN};if(!i.focus){i.focus=false;}if(!i.player&&i.player!==0){i.player=NaN;}};q=function(u){var t,s;t=u.key.toLowerCase();s={arrowleft:[0,-1,0],arrowup:[0,0,-1],arrowright:[0,1,0],arrowdown:[0,0,1],w:[1,0,-1],a:[1,-1,0],s:[1,0,1],d:[1,1,0],t:[2,0,-1],f:[2,-1,0],g:[2,0,1],h:[2,1,0],i:[3,0,-1],j:[3,-1,0],k:[3,0,1],l:[3,1,0]};if(s[t]){u.preventDefault();i.update=true;i.type="key";i.focus=true;i.player=s[t][0];i.change={column:s[t][1],row:s[t][2]};i.target={column:NaN,row:NaN};}};c=void 0;b=void 0;i={update:false};r=void 0;m=void 0;l=function(u,v){var t,s;s=[];t=u*v;while(t--){s.push(Math.floor(10*Math.random()));}t=u;while(t--){s[t]=0;}t=u*v;while(t--&&t>u*(v-1)){s[t]=0;}t=v;while(t--){s[t*u]=0;s[t*u+u-1]=0;}return s;};j=function(s,u){var t;t={};if(u||u===0){t.index=r.columns*u+s;t.column=s;t.row=u;}else{t.index=s;t.column=t.index%r.columns;t.row=Math.floor(t.index/r.rows);}t.value=r.tiles[t.index];t.x=t.column*r.tilesize;t.y=t.row*r.tilesize;t.width=r.tilesize;t.height=r.tilesize;return t;};n=function(s,t){return{columns:s,rows:t,tilesize:64,width:64*s,height:64*t,layers:["background","playground","foreground"],tiles:l(s,t),spritesheet:document.getElementById("spritesheet"),sprite:{x:{deciduous_tree:0,evergreen_tree:64,player:[128,192,256,320]},y:0,width:64,height:64},getTile:j};};r=n(8,8);p=function(){var s,t;t=void 0;c={};s=r.layers.length;while(s--){t=r.layers[s];c[t]=document.getElementById(t);c[t].setAttribute("width",r.width);c[t].setAttribute("height",r.height);}return c;};c=p();g=function(){var s,t;t=void 0;b={};s=r.layers.length;while(s--){t=r.layers[s];b[t]=c[t].getContext("2d");}return b;};b=g();c.foreground.addEventListener("touchstart",h);c.foreground.addEventListener("click",h);document.addEventListener("keyup",q);o=function(){var u,s,t,v;t=void 0;s=r.tiles.length;u=["#6495ed","#9acd32","#9acd32","#9acd32","#9acd32","#9acd32","#7fa046","#7fa046","#7fa046","#7fa046"];v={5:"deciduous_tree",9:"evergreen_tree"};b.background.lineJoin="round";b.background.lineWidth=Math.floor(0.4*r.tilesize);while(s--){t=r.getTile(s);b.background.fillStyle=u[t.value];b.background.strokeStyle=u[t.value];b.background.beginPath();b.background.rect(t.x+Math.floor(0.25*t.width),t.y+Math.floor(0.25*t.height),t.width-Math.floor(0.5*t.width),t.height-Math.floor(0.5*t.height));b.background.stroke();b.background.fill();if(v[t.value]){b.foreground.drawImage(r.spritesheet,r.sprite.x[v[t.value]],r.sprite.y,r.sprite.width,r.sprite.height,t.x+Math.floor(0.2*t.width),t.y,t.width,t.height);}}};o();a=function(t){var s,v,w,u;w=0;v=void 0;u=[];s=[];while(w<9&&s.length<t){w++;v=0;while(v<=r.tiles.length){v++;if(r.tiles[v]===w){s.push(v);break;}}}while(t--){v=r.getTile(s[t]);u[t]={column:v.column,row:v.row};}return u;};m=a(4);k=function(s){var t;t=r.getTile(m[s].column,m[s].row);b.playground.drawImage(r.spritesheet,r.sprite.x.player[s],r.sprite.y,r.sprite.width,r.sprite.height,t.x,t.y,t.width,t.height);};d=function(){var s;s=m.length;while(s--){k(s);}};d();f=function(){var s,t,u;t=void 0;u=void 0;s=void 0;if(i.update){if(i.type!=="key"){t=m.length;while(t--){if(i.target.column===m[t].column&&i.target.row===m[t].row){i.focus=true;i.player=t;break;}}if(i.focus&&Math.abs(i.target.column-m[i.player].column)<=1&&Math.abs(i.target.row-m[i.player].row)<=1){i.change={column:i.target.column-m[i.player].column,row:i.target.row-m[i.player].row};}}if(i.focus&&(i.change.column||i.change.row)){u=r.getTile(m[i.player].column,m[i.player].row);s=r.getTile(m[i.player].column+i.change.column,m[i.player].row+i.change.row);if(s.value){b.playground.clearRect(u.x,u.y,u.width,u.height);m[i.player]={column:s.column,row:s.row};d();k(i.player);}}i.update=false;i.change={column:NaN,row:NaN};i.target={column:NaN,row:NaN};}};e=function(){if(i.update){f();}window.requestAnimationFrame(e);};window.requestAnimationFrame(e);};
